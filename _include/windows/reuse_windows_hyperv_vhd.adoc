= 


ディスクパーティションのデータブロック境界が基盤となる LUN のブロック境界とアライメントされていないと、多くの場合、ストレージシステムは、オペレーティングシステムのブロックの読み取りまたは書き込みごとに 2 つのブロックの読み取りまたは書き込みを完了する必要があります。ミスアライメントが原因で追加のブロック読み取り / 書き込みが発生すると、深刻なパフォーマンスの問題が生じる可能性があります。

ミスアライメントは、マスターブートレコードで定義された各パーティションの開始セクターの位置が原因で発生します。


NOTE: Windows Server 2016 で作成されたパーティションは、デフォルトでアライメントされる必要があります。

ONTAP PowerShell Toolkit で「 Get-NaVirtualDiskAlignment 」コマンドレットを使用して、パーティションが基盤となる LUN とアライメントされているかどうかを確認します。パーティションが適切にアライメントされていない場合は、「 Repair-NaVirtualDiskAlignment 」コマンドレットを使用して、正しいアライメントで新しい VHD ファイルを作成します。このコマンドレットは、すべてのパーティションを新しいファイルにコピーします。元の VHD ファイルは変更も削除もされません。データがコピーされている間は、仮想マシンをシャットダウンする必要があります。

ONTAP PowerShell Toolkit は、ネットアップコミュニティからダウンロードできます。「 D ataONTAP.zip 」ファイルを環境変数「 %PSModulePath% 」で指定された場所に解凍する必要があります（または「 Install.ps1 」スクリプトを使用してファイルを解凍します）。インストールが完了したら、「 Get-NaHelp 」コマンドレットを使用して、各コマンドレットのヘルプを参照できます。

PowerShell Toolkit では、 MBR タイプのパーティションを含む容量固定 VHD ファイルのみがサポートされます。Windows ダイナミックディスクまたは GPT パーティションを使用する VHD はサポートされていません。さらに、 PowerShell Toolkit では、 4GB 以上のパーティションサイズが必要です。小さいパーティションは正しくアライメントできません。


NOTE: Linux 仮想マシンで VHD の GRUB ブートローダーを使用する場合は、 PowerShell Toolkit の実行後にブート設定を更新する必要があります。
